# 关于使用CocosCreator开发3D游戏的可行性报告

调研使用的引擎版本：Cocos Creator v2.1.2-beta.1

---

## 使用 CocosCreator V2.1 制作纯3D游戏的可行性调研
### CocosCreator V2.1 的3D特性支持概览
- 支持 3D 节点与3D场景的编辑。
- 摄像机支持正交投影和透视投影。
- 支持fbx格式的模型资源，以及网格、皮肤、材质和骨骼动画。
- 支持射线检测。
- 支持光源，但光源系统相当简陋。
- 不支持3D碰撞。
- 不支持3D物理系统。
- 不支持3D动作。
- 不支持3D AnimationClip。
- 不支持3D粒子动画。
- 材质系统目前仅为触控内部简易版本，以后将有较大修改且不能兼容。
- 相关3D算法支持不完善，比如矩阵、四元数、欧拉角，以及相关转换，可能需要自己实现。
- 相关介绍和API文档支持不完善，官方并未提供可靠的文档支持，现有文档中多有错漏，甚至很多东西完全没有介绍，只能自己摸索。

### 详述
#### 3D节点：
- 由于Creator3D渲染器重写底层，getRotation()和setRotation()参数都由number变成了四元数 cc.Quat；四元数和欧拉角还有旋转矩阵之间的相互转换有一定的学习成本。
- 可以通过罗德里格旋转公式将3D节点旋转至目标朝向，但模型Z轴旋转Roll不好控制。
- 使用欧拉角旋转3D节点，容易引发万向死锁问题，使用四元数又不直观。

#### 3D相机：
- 元素分组，相机只渲染对应组的元素。
- 相机组件Camera可以获取世界矩阵和视图矩阵，但是不能设置。
- 可以通过自己实现lookat方法来设置相机观察目标，但相机Z轴旋转Roll不好控制。

#### 3D模型：
- 仅支持格式fbx。
- 可以关联骨骼动画组件SkeletonAnimation，可以选择默认播放动画；可以关联蒙皮渲染组件SkinnedMeshRenderer，可以选择特定材质，材质也可以关联纹理；但动态修改材质贴图会比较困难。
- 2.1.1系列版本的Material和Effect都是试验版，后续版本不可用，将在2.3.x升级为正式版并且不能兼容。
- 有一些内置的模型如球和立方体方便做一些demo。
- 也可以使用cc.Mesh自定义模型，但是过程较为繁琐，一般也没那个必要。

    cc.macro.SHOW_MESH_WIREFRAM = true   显可以示网格图

#### 3D光照：
- 支持3D中常见的三种，点光源、平行光、聚光灯。
- 可以设置灯光是否产生阴影。
- 有节点是否接受阴影的接口。

#### 3D碰撞：
- 目前只支持点射线检测碰撞，没有包围盒，没有完善的碰撞引擎，没有3D物理引擎，这些都是硬伤。
- 单纯的射线检测碰撞，很有局限性，频繁执行效率也很低下。
- 即使投影在2D平面，也不知道模型大小.
- 官方给出的正式回复是，将在2.3.x版本中支持3D物理系统和碰撞检测，现在说来不可有期待。

### 相关资料
Creator V2.1.2 官方在论坛中的描述：https://forum.cocos.com/t/cocos-creator-v2-1-2-07-15-rc-6/79255
> 根据引擎官方的描述，Creator v2.1 的定位是一个 3D 先行版，其本质仍然是“2D 优先”的，引入 3D 元素的渲染支持，目的是为了增强 2D 游戏的表现力，并且只会逐步引入那些适合融入 2D 游戏的 3D 特性，可以说 V2.1 版本仍然是服务于2D游戏的，应称为 CocosCreator 2D V2.1（以下简称为CC2D）。

Cocos Creator 3D 公测动态：https://www.cocos.com/4830#4830
> 对应的Cocos2d-x引擎在2014年就引入了3D支持，近期还放出了名为CocosCreator 3D的产品（以下简称为CC3D），这个产品是与CC2D对应的服务于3D游戏的，并且触控计划在未来将CC2D与CC3D整合为一个产品，同时支持2D与3D游戏的开发。但CC3D目前仅在公测阶段，并且其公测名额是有限的，对于商业项目而言，使用公测版本的引擎同样有很大风险。

因调研过程中发现CC2D并不适用于开发纯3D游戏，所以并未进行相关的性能测试。

### 结论
- CC2D对于开发纯3D游戏是无法支撑的。
- 对于商业项目而言，使用公测版本的引擎CC3D同样有很大风险。

---

## 使用 CocosCreator V2.1 开发3D捕鱼的可行性调研
### 对于捕鱼项目来讲，需要3D特性的支持主要集中在模型、动画、材质、碰撞、算法：
- 捕鱼项目中需要使用3D模型的仅为鱼本身，其余部分均不必使用，同时需要支持骨骼动画。
- 捕鱼项目可与不需要光源，但是对应的需要离开光源也能显示的材质。
- 相机可以使用正交投影，但是会丧失景深的效果；若使用透视投影，则会增加路径规划的复杂度
- 鱼在游动过程中的姿态需要合适的算法计算姿态。
- 需要检测子弹和鱼的碰撞。

### 根据以上对于3D捕鱼的总结，CC2D对3D捕鱼的支持与风险如下：
- 在模型和骨骼动画方面可以支持，但性能表现未知。
- 材质方面暂时能够支持，但鉴于以后将有较大修改且不能兼容，此处将有极大风险。
- 由于CC2D目前不支持3D碰撞盒，实现子弹和鱼的碰撞检测只能使用射线检测，但每个子弹每帧进行射线检测将消耗大量性能，同时射线检测只能检测一个点，但子弹是一个面，这种做法会造成穿帮的现象，即画面上子弹与鱼相撞但射线并未命中，此处为最大风险。
- 鱼的姿态算法，包括一些基础的3D运算CC2D支持并不完善，只能由自己支持，这样将会增加时间成本，且3D旋转中的万向死锁为严重影响游戏视觉体验，同时若后期引擎有所更新，将会增加代码合并的成本。

### 结论
不建议使用此版本开发3D捕鱼。

---

### 总结
- CocosCreator V2.1 不能支持纯3D游戏的开发，仅能将部分3D特性融入2D游戏以增强表现力。
- 对于3D捕鱼的开发，风险主要来源于碰撞系统的不支持，同时材质系统也有一定的风险，不建议使用此版本开发3D捕鱼。

### 建议
- 开发H5平台3D游戏，目前看来，LayaBoxAir3D无论是文档还是示例，包括商业案例上都是最成熟的。
- 开发原生平台3D手机游戏，目前Unity是绝对首选。

---


<html>
<p align="right">By 2D客户端：陶家恒 江南</p>
<p align="right">2019年7月16日</p>
</html>
